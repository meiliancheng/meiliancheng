<!--
 * @Author: your name
 * @Date: 2021-12-28 11:25:11
 * @LastEditTime: 2022-02-17 15:22:16
 * @LastEditors: Please set LastEditors
 * @Description: 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
 * @FilePath: /myapp/public/map.html
-->
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Hello, World</title>
    <style type="text/css">
      html {
        height: 100%;
      }
      body {
        height: 100%;
        margin: 0px;
        padding: 0px;
      }
      #container {
        width: 1200px;
        height: 650px;
        margin-bottom: 35px;
      }
      #selectBox {
        margin: 35px 0px;
      }
      #selectBox select {
        width: 150px;
      }
    </style>
    <script
      type="text/javascript"
      src="https://api.map.baidu.com/api?v=3.0&ak=3sixxIxeVIbmSYOadSH3u2EvCnionSDA"
    ></script>
  </head>

  <body>
    <div id="selectBox">
      <select id="hotCity">
        <option value="北京">北京</option>
      </select>
      <select id="City">
        <option value="">请选择</option>
      </select>
      <select id="shop">
        <option value="北京">-----</option>
      </select>
    </div>
    <div id="container"></div>
  </body>
<script src="https://bang.360.cn/aj/getcitycode?callback=getHotCity">
</script>

<script>
  let jsonp=(url,data={},callback='callback')=>{
      //准备好带有padding的请求url
  let dataStr=url.indexOf('?')=== -1?'?':'&'
  for(let key in data){
      dataStr +=`${key}=${data[key]}&`
  }
  dataStr +=`callback=`+callback


  //构造 script
  let oScript=document.createElement('script')
  oScript.src=url+dataStr
  //appendChild () 方法可向节点的子节点列表的末尾添加新的子节点
  document.body.appendChild(oScript)

  // window[callback]=(data)=>{
  //     console.log(data);
  // }
  return new Promise((resolve,reject)=>{
      window[callback]=(data)=>{
          try{
              resolve(data)
          }catch(e){
              reject(e)
          }finally{
              oScript.parentNode.removeChild(oScript)// 注意这句代码，OScript移除,细节
          }
      }
  })
}

jsonp("https://bang.360.cn/aj/getcitycode",{
  }).then(response=>{
      console.log(response,'-------then');
  })
</script>
  <script type="text/javascript">
    var map = new BMap.Map("container");
    // 创建地图实例
    var point = new BMap.Point(116.404, 39.915);
    // 创建点坐标
    map.centerAndZoom(point, 15);
    // 初始化地图，设置中心点坐标和地图级别
    map.enableScrollWheelZoom(true); //开启鼠标滚轮缩放
    // map.addControl(new BMap.NavigationControl());
    // map.addControl(new BMap.ScaleControl());
    // map.addControl(new BMap.OverviewMapControl());
    // map.addControl(new BMap.MapTypeControl());
    //点  表示地图上的点，可自定义标注的图标
    var marker = new BMap.Marker(point); // 创建标注
    map.addOverlay(marker); // 将标注添加到地图中

    // 更改图片
    var opts = {
      width: 250, // 信息窗口宽度
      height: 100, // 信息窗口高度
      title: "信息窗口", // 信息窗口标题
    };
    var infoWindow = new BMap.InfoWindow("World", opts);
    marker.addEventListener("click", function () {
      map.openInfoWindow(infoWindow, map.getCenter());
    });
  </script>
</html>
